SELECT Product__c, SUM(Amount__c) FROM Line_Item__c WHERE Transaction__r.Status__c != 'Cancelled' AND Transaction__r.CreatedDate = LAST_N_DAYS:30 GROUP BY Product__c